<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de corte CNC</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

     label {
      display: block;
      margin-top: 10px;
      color: #555;
      position: relative;
      padding-left: 25px; /* Espaço para o ícone */
    }

    label i {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #007bff; /* Cor do ícone */
    }

    input, select, textarea { /* Adicionado textarea aqui */
      width: 100%;
      max-width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background-color: #e9ecef;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Calculadora de corte CNC</h1>

    <label for="material"><i class="fas fa-box"></i> Material:</label>
    <select id="material" onchange="updateMaterialInfo()">
      <option value="MDF_de_18mm">MDF de 18mm - 2750x1850mm (R$ 285,00)</option>
      <option value="MDF_de_6mm">MDF de 6mm - 2750x1850mm (R$ 150,00)</option>
      <option value="MDF_de_3mm">MDF de 3mm - 2750x1850mm (R$ 95,00)</option>
      <option value="Madeira">Madeira - 2500x1500mm (R$ 320,00)</option>
      <option value="ACM">ACM 3mm - 5000x1500mm (R$ 700,00)</option>
      <option value="PVC_Expandido_de_25mm">PVC Expandido de 25mm - 2000x1000mm (R$ 750,00)</option>
      <option value="Acrilico">Acrílico - 2000x1500mm (R$ 380,00)</option>
    </select>

    <label for="width"><i class="fas fa-ruler-horizontal"></i> Largura (mm):</label>
    <input type="number" id="width" placeholder="Insira a largura">

    <label for="height"><i class="fas fa-ruler-vertical"></i> Altura (mm):</label>
    <input type="number" id="height" placeholder="Insira a altura">

    <label for="cutPrice"><i class="fas fa-cut"></i> Valor do corte CNC por m² (R$):</label>
    <input type="number" id="cutPrice" placeholder="Insira o valor do corte" value="50">

    <label for="sandingCost"><i class="fas fa-brush"></i> Custo de Lixamento (R$):</label>
    <input type="number" id="sandingCost" placeholder="Opcional">

    <label for="finishingCost"><i class="fas fa-paint-roller"></i> Custo de Acabamento (R$):</label>
    <input type="number" id="finishingCost" placeholder="Opcional">

    <label for="shippingCost"><i class="fas fa-truck"></i> Custo de Frete (R$):</label>
    <input type="number" id="shippingCost" placeholder="Opcional">
    
    <label for="discountPercentage"><i class="fas fa-percent"></i> Desconto (%):</label>
    <input type="number" id="discountPercentage" placeholder="Opcional (ex: 10 para 10%)">

    <label for="customTitle"><i class="fas fa-heading"></i> Título Personalizado:</label>
    <input type="text" id="customTitle" placeholder="Ex: Orçamento Projeto XYZ (opcional)">

    <label for="additionalInfo"><i class="fas fa-info-circle"></i> Informações Adicionais:</label>
    <textarea id="additionalInfo" placeholder="Qualquer informação extra que queira adicionar (opcional)" rows="4"></textarea>
    <label for="clientName"><i class="fas fa-user"></i> Nome do Cliente:</label>
    <input type="text" id="clientName" placeholder="Insira o nome do cliente">

    <label for="clientContact"><i class="fas fa-phone"></i> Contato do Cliente:</label>
    <input type="text" id="clientContact" placeholder="(00) 00000-0000" oninput="formatPhone(this)">

    <button onclick="calculateMaterial()">Calcular</button>

    <div class="result" id="result"></div>

    <button id="generatePDF" onclick="generatePDF()" style="display:none;">Gerar PDF</button>
  </div>

<script>
    const materialData = {
        MDF_de_18mm: { largura: 2750, altura: 1850, preco: 285.00, peso: 68.3 },
        MDF_de_6mm: { largura: 2750, altura: 1850, preco: 150.00, peso: 40.0 },
        MDF_de_3mm: { largura: 2750, altura: 1850, preco: 95.00, peso: 30.0 },
        Madeira: { largura: 2500, altura: 1500, preco: 320.00, peso: 50.0 },
        ACM: { largura: 5000, altura: 1500, preco: 700.00, peso: 60.0 },
        PVC_Expandido_de_25mm: { largura: 2000, altura: 1000.00, preco: 750, peso: 45.0 },
        Acrilico: { largura: 2000, altura: 1500, preco: 380.00, peso: 35.0 }
    };

    let currentCalculationDetails = ''; // Renomeado para não confundir com a string final
    let customTitleText = ''; // Variável para armazenar o título personalizado
    let additionalInfoText = ''; // Variável para armazenar as informações adicionais

    function updateMaterialInfo() {
        const material = document.getElementById('material').value;
        const largura = materialData[material].largura;
        const altura = materialData[material].altura;
        const preco = materialData[material].preco;

        document.getElementById('width').placeholder = `Largura máxima: ${largura} mm`;
        document.getElementById('height').placeholder = `Altura máxima: ${altura} mm`;

        return { largura, altura, preco };
    }

    function calculateMaterial() {
        const material = document.getElementById('material').value;
        const materialInfo = materialData[material];
        const inputLargura = parseFloat(document.getElementById('width').value);
        const inputAltura = parseFloat(document.getElementById('height').value);
        const precoCortePorMetroQuadrado = parseFloat(document.getElementById('cutPrice').value);
        
        const sandingCost = parseFloat(document.getElementById('sandingCost').value) || 0;
        const finishingCost = parseFloat(document.getElementById('finishingCost').value) || 0;
        const shippingCost = parseFloat(document.getElementById('shippingCost').value) || 0;
        const discountPercentage = parseFloat(document.getElementById('discountPercentage').value) || 0;

        const nomeCliente = document.getElementById('clientName').value;
        const contatoCliente = document.getElementById('clientContact').value; 

        // Captura os valores dos novos campos
        customTitleText = document.getElementById('customTitle').value.trim();
        additionalInfoText = document.getElementById('additionalInfo').value.trim();

        if (
            !isNaN(inputLargura) && 
            !isNaN(inputAltura) && 
            inputLargura > 0 && 
            inputAltura > 0 && 
            inputLargura <= materialInfo.largura && 
            inputAltura <= materialInfo.altura
        ) {
            const areaChapa = (materialInfo.largura * materialInfo.altura) / 1000000;
            const areaUsada = (inputLargura * inputAltura) / 1000000;
            const precoPorM2 = materialInfo.preco / areaChapa;
            const totalPrecoMaterial = areaUsada * precoPorM2;
            const totalPrecoCorte = areaUsada * precoCortePorMetroQuadrado;
            
            let subtotal = totalPrecoMaterial + totalPrecoCorte;

            subtotal += sandingCost;
            subtotal += finishingCost;
            subtotal += shippingCost;

            if (discountPercentage > 0) {
                subtotal = subtotal * (1 - discountPercentage / 100);
            }

            const totalPreco = subtotal.toFixed(2);

            const pesoPorM2 = materialInfo.peso / areaChapa;
            const pesoCalculado = (areaUsada * pesoPorM2).toFixed(2);

            // Montar a string currentCalculationDetails (apenas os detalhes do cálculo)
            currentCalculationDetails =
                `Material: ${material}\n` +
                `Área Utilizada: ${areaUsada.toFixed(4)} m²\n` +
                `Peso Estimado: ${pesoCalculado} kg\n` +
                `Preço do Material: R$ ${totalPrecoMaterial.toFixed(2)}\n` +
                `Preço do Corte: R$ ${totalPrecoCorte.toFixed(2)}\n`;
            
            if (sandingCost > 0) {
                currentCalculationDetails += `Custo de Lixamento: R$ ${sandingCost.toFixed(2)}\n`;
            }
            if (finishingCost > 0) {
                currentCalculationDetails += `Custo de Acabamento: R$ ${finishingCost.toFixed(2)}\n`;
            }
            if (shippingCost > 0) {
                currentCalculationDetails += `Custo de Frete: R$ ${shippingCost.toFixed(2)}\n`;
            }
            if (discountPercentage > 0) {
                currentCalculationDetails += `Desconto: ${discountPercentage.toFixed(2)}%\n`;
            }
            
            currentCalculationDetails += `Preço Total: R$ ${totalPreco}`;

            // A string que vai para o HTML (resultado na tela)
            let resultHtml = currentCalculationDetails.replace(/\n/g, "<br>");
            
            if (additionalInfoText) {
                resultHtml += `<br><br><b>Informações Adicionais:</b><br>${additionalInfoText.replace(/\n/g, "<br>")}`;
            }

            resultHtml += `<br><br><b>Cliente:</b> ${nomeCliente}<br><b>Contato:</b> ${contatoCliente}`;


            document.getElementById('result').innerHTML = resultHtml;
            document.getElementById('generatePDF').style.display = 'block';
        } else {
            document.getElementById('result').innerHTML = "Por favor, insira dimensões válidas dentro dos limites do material.";
            document.getElementById('generatePDF').style.display = 'none';
        }
    }

    async function generatePDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        const dataOrcamento = new Date();
        const diaOrcamento = String(dataOrcamento.getDate()).padStart(2, '0');
        const mesOrcamento = String(dataOrcamento.getMonth() + 1).padStart(2, '0');
        const anoOrcamento = dataOrcamento.getFullYear();
        const dataFormatadaOrcamento = `${diaOrcamento}/${mesOrcamento}/${anoOrcamento}`;

        const dataExpiracao = new Date();
        dataExpiracao.setDate(dataOrcamento.getDate() + 15);
        const diaExpiracao = String(dataExpiracao.getDate()).padStart(2, '0');
        const mesExpiracao = String(dataExpiracao.getMonth() + 1).padStart(2, '0');
        const anoExpiracao = dataExpiracao.getFullYear();
        const dataFormatadaExpiracao = `${diaExpiracao}/${mesExpiracao}/${anoExpiracao}`;

        let clientName = document.getElementById('clientName').value.trim();
        let fileName = "orcamento_corte_CNC.pdf"; 

        if (clientName) {
            clientName = clientName.replace(/[^a-zA-Z0-9 ]/g, "").replace(/ /g, "_");
            fileName = `${clientName}_orcamento_CNC.pdf`;
        }

        const logoImg = new Image();
        logoImg.src = 'logo-calculadora1.png'; // Verifique se este nome está correto no seu GitHub!

        logoImg.onload = () => {
            doc.addImage(logoImg, 'PNG', 10, 10, 50, 20); 

            let yPos = 40; 

            // Adiciona o título personalizado, se existir
            if (customTitleText) {
                doc.setFontSize(14); // Tamanho um pouco menor que o título principal
                doc.text(customTitleText, 10, yPos);
                yPos += 10;
            }

            doc.setFontSize(16);
            doc.text("Orçamento de Corte CNC", 10, yPos); 
            yPos += 10; 

            doc.setFontSize(12);
            doc.text(`Data do Orçamento: ${dataFormatadaOrcamento}`, 10, yPos);
            yPos += 7;
            doc.text(`Expira em: ${dataFormatadaExpiracao}`, 10, yPos);
            yPos += 10; 

            // Adiciona os detalhes do cálculo
            const calculationLines = currentCalculationDetails.split('\n');
            calculationLines.forEach(line => {
                doc.text(line, 10, yPos);
                yPos += 7; 
            });

            // Adiciona as informações adicionais, se existirem
            if (additionalInfoText) {
                yPos += 10; // Espaço antes das informações adicionais
                doc.setFontSize(12);
                doc.text("Informações Adicionais:", 10, yPos);
                yPos += 7;
                // Usa splitTextToSize para quebrar o texto longo em várias linhas
                const additionalInfoLines = doc.splitTextToSize(additionalInfoText, 180); // 180mm de largura
                additionalInfoLines.forEach(line => {
                    doc.text(line, 10, yPos);
                    yPos += 7;
                });
            }

            // Adiciona informações do cliente
            const nomeCliente = document.getElementById('clientName').value;
            const contatoCliente = document.getElementById('clientContact').value;
            
            yPos += 10; // Espaço antes das informações do cliente
            doc.setFontSize(12);
            doc.text(`Cliente: ${nomeCliente}`, 10, yPos);
            yPos += 7;
            doc.text(`Contato: ${contatoCliente}`, 10, yPos);

            doc.save(fileName); 
        };

        logoImg.onerror = () => {
            let yPos = 10;
            
            if (customTitleText) {
                doc.setFontSize(14);
                doc.text(customTitleText, 10, yPos);
                yPos += 10;
            }

            doc.setFontSize(16);
            doc.text("Orçamento de Corte CNC", 10, yPos);
            yPos += 10;

            doc.setFontSize(12);
            doc.text(`Data do Orçamento: ${dataFormatadaOrcamento}`, 10, yPos);
            yPos += 7;
            doc.text(`Expira em: ${dataFormatadaExpiracao}`, 10, yPos);
            yPos += 10;

            // Adiciona os detalhes do cálculo
            const calculationLines = currentCalculationDetails.split('\n');
            calculationLines.forEach(line => {
                doc.text(line, 10, yPos);
                yPos += 7; 
            });

            // Adiciona as informações adicionais, se existirem (fallback)
            if (additionalInfoText) {
                yPos += 10;
                doc.setFontSize(12);
                doc.text("Informações Adicionais:", 10, yPos);
                yPos += 7;
                const additionalInfoLines = doc.splitTextToSize(additionalInfoText, 180);
                additionalInfoLines.forEach(line => {
                    doc.text(line, 10, yPos);
                    yPos += 7;
                });
            }

            // Adiciona informações do cliente (fallback)
            const nomeCliente = document.getElementById('clientName').value;
            const contatoCliente = document.getElementById('clientContact').value;
            
            yPos += 10;
            doc.setFontSize(12);
            doc.text(`Cliente: ${nomeCliente}`, 10, yPos);
            yPos += 7;
            doc.text(`Contato: ${contatoCliente}`, 10, yPos);

            doc.save(fileName); 
        };
    }

    function formatPhone(input) {
        const phone = input.value.replace(/\D/g, '');
        if (phone.length <= 10) {
            input.value = phone.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
        } else {
            input.value = phone.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
        }
    }

    window.onload = updateMaterialInfo;
</script>

</body>
</html>

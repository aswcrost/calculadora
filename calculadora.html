<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de corte CNC</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: #fff;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    label {
      display: block;
      margin-top: 10px;
      color: #555;
      position: relative;
      padding-left: 25px; /* Espaço para o ícone */
    }

    label i {
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      color: #007bff; /* Cor do ícone */
    }

    input, select, textarea {
      width: 100%;
      max-width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }

    .material-item-block {
      border: 1px solid #e0e0e0;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      background-color: #fcfcfc;
      position: relative;
    }

    .material-item-block .remove-item-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: #dc3545;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      line-height: 1; /* Para centralizar o ícone */
    }

    .material-item-block .remove-item-btn:hover {
      background-color: #c82333;
    }

    /* Estilo específico para agrupar Serviço Adicional */
    .service-group {
      display: flex;
      gap: 10px; /* Espaço entre os campos */
      align-items: flex-end; /* Alinhar a base dos inputs */
    }
    .service-group label {
        flex-grow: 1;
        padding-left: 0; /* Remover padding do label para alinhamento */
    }
    .service-group label i {
        position: static; /* Remover posicionamento absoluto */
        transform: none; /* Remover transformação */
        margin-right: 5px; /* Espaço entre ícone e texto */
    }
    .service-group input {
        flex-grow: 1;
    }
    .service-group .service-value {
        width: 120px; /* Largura fixa para o campo de valor */
        flex-grow: 0;
    }

    button {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }
    
    .add-item-btn {
        background-color: #28a745;
    }
    .add-item-btn:hover {
        background-color: #218838;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background-color: #e9ecef;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>Calculadora de corte CNC</h1>

    <div id="material-items-container">
      <div class="material-item-block" id="material-block-0">
        <label for="material_0"><i class="fas fa-box"></i> Material:</label>
        <select id="material_0" onchange="updateMaterialInfo(this)">
          <option value="MDF_de_18mm">MDF de 18mm - 2750x1850mm (R$ 285,00)</option>
          <option value="MDF_de_6mm">MDF de 6mm - 2750x1850mm (R$ 150,00)</option>
          <option value="MDF_de_3mm">MDF de 3mm - 2750x1850mm (R$ 95,00)</option>
          <option value="Madeira">Madeira - 2500x1500mm (R$ 320,00)</option>
          <option value="ACM">ACM 3mm - 5000x1500mm (R$ 700,00)</option>
          <option value="PVC_Expandido_de_25mm">PVC Expandido de 25mm - 2000x1000mm (R$ 750,00)</option>
          <option value="Acrilico">Acrílico - 2000x1500mm (R$ 380,00)</option>
        </select>

        <label for="width_0"><i class="fas fa-ruler-horizontal"></i> Largura (mm):</label>
        <input type="number" id="width_0" placeholder="Insira a largura">

        <label for="height_0"><i class="fas fa-ruler-vertical"></i> Altura (mm):</label>
        <input type="number" id="height_0" placeholder="Insira a altura">

        <button type="button" class="remove-item-btn" onclick="removeMaterialItem(this)" style="display:none;">&times;</button>
      </div>
    </div>

    <button type="button" class="add-item-btn" onclick="addMaterialItem()">Adicionar novo item</button>

    <label for="cutPrice"><i class="fas fa-cut"></i> Valor do corte CNC por m² (R$):</label>
    <input type="number" id="cutPrice" placeholder="Insira o valor do corte" value="50">

    <label for="sandingCost"><i class="fas fa-brush"></i> Custo de Lixamento (R$):</label>
    <input type="number" id="sandingCost" placeholder="Opcional">

    <label for="finishingCost"><i class="fas fa-paint-roller"></i> Custo de Acabamento (R$):</label>
    <input type="number" id="finishingCost" placeholder="Opcional">

    <label for="shippingCost"><i class="fas fa-truck"></i> Custo de Frete (R$):</label>
    <input type="number" id="shippingCost" placeholder="Opcional">
    
    <label for="discountPercentage"><i class="fas fa-percent"></i> Desconto (%):</label>
    <input type="number" id="discountPercentage" placeholder="Opcional (ex: 10 para 10%)">

    <label for="additionalServiceName"><i class="fas fa-plus-circle"></i> Serviço Adicional:</label>
    <div class="service-group">
        <input type="text" id="additionalServiceName" placeholder="Descrição do serviço (opcional)">
        <input type="number" id="additionalServiceValue" class="service-value" placeholder="Valor (R$)" value="0">
    </div>

    <label for="additionalInfo"><i class="fas fa-info-circle"></i> Informações Adicionais:</label>
    <textarea id="additionalInfo" placeholder="Qualquer informação extra que queira adicionar (opcional)" rows="4"></textarea>

    <label for="clientName"><i class="fas fa-user"></i> Nome do Cliente:</label>
    <input type="text" id="clientName" placeholder="Insira o nome do cliente">

    <label for="clientContact"><i class="fas fa-phone"></i> Contato do Cliente:</label>
    <input type="text" id="clientContact" placeholder="(00) 00000-0000" oninput="formatPhone(this)">

    <button onclick="calculateMaterial()">Calcular</button>

    <div class="result" id="result"></div>

    <button id="generatePDF" onclick="generatePDF()" style="display:none;">Gerar PDF</button>
  </div>

<script>
    const materialData = {
        MDF_de_18mm: { largura: 2750, altura: 1850, preco: 285.00, peso: 68.3 },
        MDF_de_6mm: { largura: 2750, altura: 1850, preco: 150.00, peso: 40.0 },
        MDF_de_3mm: { largura: 2750, altura: 1850, preco: 95.00, peso: 30.0 },
        Madeira: { largura: 2500, altura: 1500, preco: 320.00, peso: 50.0 },
        ACM: { largura: 5000, altura: 1500, preco: 700.00, peso: 60.0 },
        PVC_Expandido_de_25mm: { largura: 2000, altura: 1000.00, preco: 750, peso: 45.0 },
        Acrilico: { largura: 2000, altura: 1500, preco: 380.00, peso: 35.0 }
    };

    // Adiciona a área da chapa a cada material para facilitar cálculos futuros
    for (const key in materialData) {
        if (materialData.hasOwnProperty(key)) {
            materialData[key].areaChapa = (materialData[key].largura * materialData[key].altura) / 1000000;
        }
    }

    let calculationDataForPDF = [];
    let additionalInfoText = '';
    let finalCalculatedTotal = 0;
    let itemCounter = 0; // Para gerar IDs únicos para os blocos de material

    function updateMaterialInfo(selectElement) {
        const material = selectElement.value;
        const materialInfo = materialData[material];
        
        // Encontra os inputs de largura e altura dentro do mesmo bloco
        const block = selectElement.closest('.material-item-block');
        const widthInput = block.querySelector('input[id^="width_"]');
        const heightInput = block.querySelector('input[id^="height_"]');

        if (widthInput && heightInput) {
            widthInput.placeholder = `Largura máxima: ${materialInfo.largura} mm`;
            heightInput.placeholder = `Altura máxima: ${materialInfo.altura} mm`;
        }
    }

    function addMaterialItem() {
        itemCounter++; // Incrementa o contador para o novo ID

        const container = document.getElementById('material-items-container');
        const newItemBlock = document.createElement('div');
        newItemBlock.className = 'material-item-block';
        newItemBlock.id = `material-block-${itemCounter}`;
        newItemBlock.innerHTML = `
            <label for="material_${itemCounter}"><i class="fas fa-box"></i> Material:</label>
            <select id="material_${itemCounter}" onchange="updateMaterialInfo(this)">
                <option value="MDF_de_18mm">MDF de 18mm - 2750x1850mm (R$ 285,00)</option>
                <option value="MDF_de_6mm">MDF de 6mm - 2750x1850mm (R$ 150,00)</option>
                <option value="MDF_de_3mm">MDF de 3mm - 2750x1850mm (R$ 95,00)</option>
                <option value="Madeira">Madeira - 2500x1500mm (R$ 320,00)</option>
                <option value="ACM">ACM 3mm - 5000x1500mm (R$ 700,00)</option>
                <option value="PVC_Expandido_de_25mm">PVC Expandido de 25mm - 2000x1000mm (R$ 750,00)</option>
                <option value="Acrilico">Acrílico - 2000x1500mm (R$ 380,00)</option>
            </select>

            <label for="width_${itemCounter}"><i class="fas fa-ruler-horizontal"></i> Largura (mm):</label>
            <input type="number" id="width_${itemCounter}" placeholder="Insira a largura">

            <label for="height_${itemCounter}"><i class="fas fa-ruler-vertical"></i> Altura (mm):</label>
            <input type="number" id="height_${itemCounter}" placeholder="Insira a altura">

            <button type="button" class="remove-item-btn" onclick="removeMaterialItem(this)">&times;</button>
        `;
        container.appendChild(newItemBlock);

        // Atualiza o placeholder do novo item para o material padrão
        const newSelect = document.getElementById(`material_${itemCounter}`);
        updateMaterialInfo(newSelect);
    }

    function removeMaterialItem(buttonElement) {
        const itemBlock = buttonElement.closest('.material-item-block');
        itemBlock.remove();
        // Não é necessário reajustar itemCounter, apenas para IDs únicos
    }

    function calculateMaterial() {
        // Lógica de cálculo será atualizada aqui em breve
        // Por enquanto, apenas para evitar erros se for clicado antes do update
        document.getElementById('result').innerHTML = "Calculando...";
        document.getElementById('generatePDF').style.display = 'none';
    }

    async function generatePDF() {
        // Lógica de PDF será atualizada aqui em breve
    }

    function formatPhone(input) {
        const phone = input.value.replace(/\D/g, '');
        if (phone.length <= 10) {
            input.value = phone.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
        } else {
            input.value = phone.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
        }
    }

    window.onload = () => {
        updateMaterialInfo(document.getElementById('material_0'));
        // Exibe o botão de remover para os itens adicionados, mas mantém oculto para o primeiro
        const firstRemoveBtn = document.querySelector('#material-block-0 .remove-item-btn');
        if (firstRemoveBtn) {
            firstRemoveBtn.style.display = 'none'; 
        }
    };
</script>

</body>
</html>
